<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anfo Word Rush</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Cute font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: linear-gradient(135deg, #fff7f2, #f7f5ff);
      color: #2b2b2b;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    #app {
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.08);
      padding: 18px 18px 24px;
    }

    h1, h2, h3 {
      text-align: center;
      margin-bottom: 10px;
    }

    .logo {
      font-weight: 800;
      font-size: 26px;
      text-align: center;
      margin-bottom: 4px;
      color: #ff8a7a;
      letter-spacing: 0.04em;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #8a8a8a;
      margin-bottom: 16px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
      background: #ff8a7a;
      color: #fff;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
    }

    button:hover {
      background: #ff7a69;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-secondary {
      background: #f3f0ff;
      color: #5b4ea3;
    }

    .btn-secondary:hover {
      background: #e6deff;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .center {
      text-align: center;
    }

    .section {
      margin-bottom: 16px;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 8px;
    }

    .chip {
      padding: 6px 12px;
      border-radius: 999px;
      background: #f9f4ff;
      font-size: 13px;
      cursor: pointer;
      color: #6b5aa8;
      border: 1px solid transparent;
    }

    .chip.selected {
      background: #ffcfdf;
      color: #b03b6f;
      border-color: #ff9fbf;
    }

    /* Top bar */
    #top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 12px;
    }

    #progress-container {
      flex: 1;
      margin: 0 8px;
      background: #f7e9ff;
      border-radius: 999px;
      height: 10px;
      overflow: hidden;
      position: relative;
    }

    #progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff9fbf, #ffc15e);
      border-radius: 999px;
      transition: width 0.25s ease;
    }

    #progress-label {
      font-size: 11px;
      color: #8a7bb8;
      min-width: 70px;
      text-align: right;
    }

    #timer {
      background: #ffe4dc;
      color: #ff7a59;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 600;
      min-width: 40px;
      text-align: center;
    }

    /* Avatar */
    #avatar-container {
      display: flex;
      justify-content: center;
      margin: 10px 0 14px;
    }

    #avatar-learn,
    #avatar-challenge {
      width: 96px;
      height: 96px;
      object-fit: contain;
      transition: transform 0.2s ease;
    }

    .avatar-bounce {
      animation: bounce 0.4s ease;
    }

    @keyframes bounce {
      0% { transform: scale(1); }
      30% { transform: scale(1.1); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    /* Learn card */
    #learn-card {
      background: #fff7fb;
      border-radius: 18px;
      padding: 14px;
      text-align: center;
      border: 1px solid #ffe0f2;
    }

    #lesson-img {
      width: 120px;
      height: 120px;
      object-fit: contain;
      margin-bottom: 8px;
    }

    #lesson-word {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #ff7a7a;
    }

    #lesson-meaning {
      font-size: 15px;
      color: #555;
      margin-bottom: 6px;
    }

    #lesson-sentence {
      font-size: 13px;
      color: #777;
      margin-bottom: 8px;
    }

    .learn-actions {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    /* Challenge */
    #challenge-word {
      text-align: center;
      font-size: 22px;
      font-weight: 700;
      margin: 8px 0 12px;
      color: #ff7a7a;
    }

    #options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .option {
      width: 100%;
      text-align: center;
      font-size: 13px;
      padding: 10px 6px;
      background: #fdf5ff;
      color: #5b4ea3;
      border-radius: 14px;
      border: 1px solid transparent;
    }

    .option.correct {
      background: #e1ffe8;
      color: #1b7a1b;
      border-color: #9be7b0;
    }

    .option.wrong {
      background: #ffe1e1;
      color: #b00020;
      border-color: #ff9b9b;
    }

    /* Result screen */
    #results-list {
      margin-top: 8px;
      font-size: 13px;
      list-style: none;
    }

    #results-list li {
      margin-bottom: 4px;
    }

    .actions-row {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    /* Responsive */
    @media (max-width: 480px) {
      #app {
        border-radius: 0;
        max-width: 100%;
        height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- START SCREEN -->
    <div id="screen-start" class="screen active">
      <div class="logo">Anfo</div>
      <div class="subtitle">Cute word game for learning English</div>

      <div class="section center">
        <h3>Choose level</h3>
        <div class="chips" id="level-chips">
          <div class="chip selected" data-level="beginner">Beginner</div>
          <div class="chip" data-level="intermediate">Intermediate</div>
        </div>
      </div>

      <div class="section center">
        <h3>Choose topic</h3>
        <div class="chips" id="topic-chips">
          <div class="chip selected" data-topic="daily">Daily</div>
          <div class="chip" data-topic="food">Food</div>
          <div class="chip" data-topic="travel">Travel</div>
        </div>
      </div>

      <div class="section center">
        <button id="btn-start-learn">Start learning</button>
      </div>
    </div>

    <!-- LEARN SCREEN -->
    <div id="screen-learn" class="screen">
      <div id="top-bar">
        <span style="font-size:12px; color:#8a7bb8;">Learn mode</span>
        <div id="progress-container">
          <div id="progress-bar"></div>
        </div>
        <span id="progress-label">0 / 0</span>
      </div>

      <div id="avatar-container">
        <img id="avatar-learn" src="avatar_neutral.png" alt="avatar" />
      </div>

      <div id="learn-card">
        <img id="lesson-img" src="" alt="lesson image" />
        <div id="lesson-word"></div>
        <div id="lesson-meaning"></div>
        <div id="lesson-sentence"></div>
        <div class="learn-actions">
          <button id="btn-play-audio">Play audio</button>
          <button class="btn-secondary" id="btn-next-lesson">Next</button>
        </div>
      </div>

      <div class="actions-row">
        <button id="btn-go-challenge" style="display:none;">Go to challenge üî•</button>
        <button class="btn-secondary" id="btn-back-start">Back</button>
      </div>
    </div>

    <!-- CHALLENGE SCREEN -->
    <div id="screen-challenge" class="screen">
      <div id="top-bar">
        <span style="font-size:12px; color:#8a7bb8;">Challenge</span>
        <div id="progress-container">
          <div id="progress-bar-challenge"></div>
        </div>
        <span id="timer">6</span>
      </div>

      <div id="avatar-container">
        <img id="avatar-challenge" src="avatar_neutral.png" alt="avatar" />
      </div>

      <div id="challenge-word">word</div>

      <div id="options">
        <button class="option"></button>
        <button class="option"></button>
        <button class="option"></button>
        <button class="option"></button>
      </div>

      <div class="actions-row">
        <button class="btn-secondary" id="btn-exit-challenge">Exit</button>
      </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="screen">
      <h2>Stage result</h2>
      <div class="center" style="margin-top:8px;">
        <div>Score: <strong id="final-score">0</strong></div>
        <div>Accuracy: <strong id="final-accuracy">0%</strong></div>
      </div>

      <div class="section">
        <h3 style="font-size:14px; margin-bottom:4px;">Wrong words</h3>
        <ul id="results-list"></ul>
      </div>

      <div class="actions-row">
        <button id="btn-repeat-wrong">Repeat wrong üîÅ</button>
        <button class="btn-secondary" id="btn-play-again">Play again</button>
        <button class="btn-secondary" id="btn-back-home">Home</button>
      </div>
    </div>
  </div>

  <!-- SFX (optional, add your own files) -->
  <audio id="sfx-correct" src="sfx_correct.mp3"></audio>
  <audio id="sfx-wrong" src="sfx_wrong.mp3"></audio>
  <audio id="sfx-click" src="sfx_click.mp3"></audio>

  <!-- WORDS DATA (external file) -->
  <script src="words.js"></script>

  <script>
    // words.js must define: const WORDS_DATA = { beginner: { daily: [...], ... }, intermediate: {...} };

    // -----------------------------
    // State
    // -----------------------------
    let currentLevel = "beginner";
    let currentTopic = "daily";
    let lessons = [];
    let currentLessonIndex = 0;

    let questions = [];
    let currentQuestionIndex = 0;
    let wrongWords = [];
    let score = 0;
    let totalQuestions = 0;
    let correctAnswers = 0;
    let timerInterval = null;
    const timePerQuestion = 6;

    // -----------------------------
    // Elements
    // -----------------------------
    const screenStart = document.getElementById("screen-start");
    const screenLearn = document.getElementById("screen-learn");
    const screenChallenge = document.getElementById("screen-challenge");
    const screenResult = document.getElementById("screen-result");

    const levelChips = document.getElementById("level-chips");
    const topicChips = document.getElementById("topic-chips");

    const btnStartLearn = document.getElementById("btn-start-learn");

    const progressBarLearn = document.getElementById("progress-bar");
    const progressLabelLearn = document.getElementById("progress-label");

    const lessonImg = document.getElementById("lesson-img");
    const lessonWord = document.getElementById("lesson-word");
    const lessonMeaning = document.getElementById("lesson-meaning");
    const lessonSentence = document.getElementById("lesson-sentence");
    const btnPlayAudio = document.getElementById("btn-play-audio");
    const btnNextLesson = document.getElementById("btn-next-lesson");
    const btnGoChallenge = document.getElementById("btn-go-challenge");
    const btnBackStart = document.getElementById("btn-back-start");

    const avatarLearn = document.getElementById("avatar-learn");
    const avatarChallenge = document.getElementById("avatar-challenge");

    const progressBarChallenge = document.getElementById("progress-bar-challenge");
    const timerLabel = document.getElementById("timer");
    const challengeWord = document.getElementById("challenge-word");
    const optionButtons = document.querySelectorAll(".option");
    const btnExitChallenge = document.getElementById("btn-exit-challenge");

    const finalScoreLabel = document.getElementById("final-score");
    const finalAccuracyLabel = document.getElementById("final-accuracy");
    const resultsList = document.getElementById("results-list");
    const btnRepeatWrong = document.getElementById("btn-repeat-wrong");
    const btnPlayAgain = document.getElementById("btn-play-again");
    const btnBackHome = document.getElementById("btn-back-home");

    const sfxCorrect = document.getElementById("sfx-correct");
    const sfxWrong = document.getElementById("sfx-wrong");
    const sfxClick = document.getElementById("sfx-click");

    // -----------------------------
    // Helpers
    // -----------------------------
    function showScreen(screen) {
      [screenStart, screenLearn, screenChallenge, screenResult].forEach(s => s.classList.remove("active"));
      screen.classList.add("active");
    }

    function playSfx(audioEl) {
      if (!audioEl) return;
      audioEl.currentTime = 0;
      audioEl.play().catch(() => {});
    }

    function setAvatarMood(targetImg, mood) {
      let src = "avatar_neutral.png";
      if (mood === "sad") src = "avatar_sad.png";
      else if (mood === "happy") src = "avatar_happy.png";
      else if (mood === "super-happy") src = "avatar_super_happy.png";

      targetImg.src = src;
      targetImg.classList.remove("avatar-bounce");
      void targetImg.offsetWidth;
      targetImg.classList.add("avatar-bounce");
    }

    function updateLearnProgress() {
      const total = lessons.length || 1;
      const current = currentLessonIndex + 1;
      const percent = (current / total) * 100;
      progressBarLearn.style.width = percent + "%";
      progressLabelLearn.textContent = current + " / " + total;
    }

    function updateChallengeProgress() {
      const total = totalQuestions || 1;
      const current = currentQuestionIndex;
      const percent = (current / total) * 100;
      progressBarChallenge.style.width = percent + "%";
    }

    // -----------------------------
    // Level & topic selection
    // -----------------------------
    levelChips.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      levelChips.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
      chip.classList.add("selected");
      currentLevel = chip.dataset.level;
      playSfx(sfxClick);
    });

    topicChips.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      topicChips.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
      chip.classList.add("selected");
      currentTopic = chip.dataset.topic;
      playSfx(sfxClick);
    });

    // -----------------------------
    // Start learning
    // -----------------------------
    btnStartLearn.addEventListener("click", () => {
      playSfx(sfxClick);
      if (!window.WORDS_DATA) {
        alert("WORDS_DATA is not defined. Please include words.js.");
        return;
      }
      const levelData = WORDS_DATA[currentLevel] || {};
      lessons = levelData[currentTopic] || [];
      if (!lessons.length) {
        alert("No words for this level/topic yet.");
        return;
      }
      currentLessonIndex = 0;
      showScreen(screenLearn);
      setAvatarMood(avatarLearn, "neutral");
      showLesson();
    });

    btnBackStart.addEventListener("click", () => {
      playSfx(sfxClick);
      showScreen(screenStart);
    });

    function showLesson() {
      const l = lessons[currentLessonIndex];
      lessonImg.src = l.image || "placeholder.png";
      lessonWord.textContent = l.word;
      lessonMeaning.textContent = l.meaning;
      lessonSentence.textContent = l.sentence;
      btnGoChallenge.style.display = (currentLessonIndex >= lessons.length - 1) ? "inline-block" : "none";
      updateLearnProgress();
    }

    btnNextLesson.addEventListener("click", () => {
      playSfx(sfxClick);
      if (currentLessonIndex < lessons.length - 1) {
        currentLessonIndex++;
        showLesson();
      } else {
        setAvatarMood(avatarLearn, "happy");
        btnGoChallenge.style.display = "inline-block";
      }
    });

    btnPlayAudio.addEventListener("click", () => {
      playSfx(sfxClick);
      const l = lessons[currentLessonIndex];
      if (!l.audio) return;
      const audio = new Audio(l.audio);
      audio.play().catch(() => {});
    });

    btnGoChallenge.addEventListener("click", () => {
      playSfx(sfxClick);
      startChallenge(false);
    });

    // -----------------------------
    // Challenge
    // -----------------------------
    function startChallenge(fromWrongOnly) {
      showScreen(screenChallenge);
      setAvatarMood(avatarChallenge, "neutral");
      score = 0;
      correctAnswers = 0;

      if (fromWrongOnly && wrongWords.length) {
        questions = [...wrongWords];
        wrongWords = [];
      } else {
        questions = [...lessons];
        wrongWords = [];
      }

      totalQuestions = questions.length;
      currentQuestionIndex = 0;
      progressBarChallenge.style.width = "0%";
      loadQuestion();
    }

    function loadQuestion() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      if (currentQuestionIndex >= questions.length) {
        endChallenge();
        return;
      }

      updateChallengeProgress();

      const q = questions[currentQuestionIndex];
      challengeWord.textContent = q.word;

      let options = [q.meaning];
      while (options.length < 4 && lessons.length > 1) {
        let random = lessons[Math.floor(Math.random() * lessons.length)].meaning;
        if (!options.includes(random)) options.push(random);
      }
      while (options.length < 4) {
        options.push("‚Äî");
      }

      options.sort(() => Math.random() - 0.5);

      optionButtons.forEach((btn, i) => {
        btn.disabled = false;
        btn.classList.remove("correct", "wrong");
        btn.textContent = options[i];
        btn.onclick = () => checkAnswer(options[i] === q.meaning, q, btn);
      });

      startTimer();
    }

    function startTimer() {
      let timeLeft = timePerQuestion;
      timerLabel.textContent = timeLeft;
      timerInterval = setInterval(() => {
        timeLeft--;
        timerLabel.textContent = timeLeft;
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerInterval = null;
          handleTimeout();
        }
      }, 1000);
    }

    function handleTimeout() {
      const q = questions[currentQuestionIndex];
      wrongWords.push(q);
      setAvatarMood(avatarChallenge, "sad");
      playSfx(sfxWrong);
      optionButtons.forEach(btn => btn.disabled = true);
      setTimeout(() => {
        currentQuestionIndex++;
        loadQuestion();
      }, 700);
    }

    function checkAnswer(isCorrect, wordObj, btn) {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }

      optionButtons.forEach(b => b.disabled = true);

      if (isCorrect) {
        score += 10;
        correctAnswers++;
        btn.classList.add("correct");
        setAvatarMood(avatarChallenge, "happy");
        playSfx(sfxCorrect);
      } else {
        score -= 5;
        wrongWords.push(wordObj);
        btn.classList.add("wrong");
        setAvatarMood(avatarChallenge, "sad");
        playSfx(sfxWrong);
      }

      setTimeout(() => {
        currentQuestionIndex++;
        loadQuestion();
      }, 700);
    }

    function endChallenge() {
      showScreen(screenResult);
      finalScoreLabel.textContent = score;
      const accuracy = totalQuestions ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
      finalAccuracyLabel.textContent = accuracy + "%";

      resultsList.innerHTML = "";
      if (!wrongWords.length) {
        const li = document.createElement("li");
        li.textContent = "No wrong words. Great job! üéâ";
        resultsList.appendChild(li);
      } else {
        wrongWords.forEach(w => {
          const li = document.createElement("li");
          li.textContent = w.word + " = " + w.meaning;
          resultsList.appendChild(li);
        });
      }
    }

    btnExitChallenge.addEventListener("click", () => {
      playSfx(sfxClick);
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      showScreen(screenStart);
    });

    btnRepeatWrong.addEventListener("click", () => {
      playSfx(sfxClick);
      if (!wrongWords.length) {
        alert("No wrong words to repeat.");
        return;
      }
      startChallenge(true);
    });

    btnPlayAgain.addEventListener("click", () => {
      playSfx(sfxClick);
      startChallenge(false);
    });

    btnBackHome.addEventListener("click", () => {
      playSfx(sfxClick);
      showScreen(screenStart);
    });
  </script>
</body>
</html>
