<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anfo Word Rush</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Cute font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: linear-gradient(135deg, #fff7f2, #f7f5ff);
      color: #2b2b2b;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    #app {
      width: 100%;
      max-width: 480px;
      background: #ffffff;
      border-radius: 24px;
      box-shadow: 0 14px 40px rgba(0,0,0,0.08);
      padding: 18px 18px 24px;
    }

    h1, h2, h3 {
      text-align: center;
      margin-bottom: 10px;
    }

    .logo {
      font-weight: 800;
      font-size: 26px;
      text-align: center;
      margin-bottom: 4px;
      color: #ff8a7a;
      letter-spacing: 0.04em;
    }

    .subtitle {
      text-align: center;
      font-size: 13px;
      color: #8a8a8a;
      margin-bottom: 16px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 14px;
      cursor: pointer;
      background: #ff8a7a;
      color: #fff;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
    }

    button:hover {
      background: #ff7a69;
      box-shadow: 0 4px 12px rgba(0,0,0,0.12);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .btn-secondary {
      background: #f3f0ff;
      color: #5b4ea3;
    }

    .btn-secondary:hover {
      background: #e6deff;
    }

    .screen {
      display: none;
    }

    .screen.active {
      display: block;
    }

    .center {
      text-align: center;
    }

    .section {
      margin-bottom: 16px;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-top: 8px;
    }

    .chip {
      padding: 6px 12px;
      border-radius: 999px;
      background: #f9f4ff;
      font-size: 13px;
      cursor: pointer;
      color: #6b5aa8;
      border: 1px solid transparent;
    }

    .chip.selected {
      background: #ffcfdf;
      color: #b03b6f;
      border-color: #ff9fbf;
    }

    .actions-row {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    /* Learn screen */
    #learn-card {
      background: #fff7fb;
      border-radius: 18px;
      padding: 20px 16px;
      text-align: center;
      border: 1px solid #ffe0f2;
      margin-top: 10px;
    }

    #learn-word {
      font-size: 26px;
      font-weight: 700;
      color: #ff7a7a;
      margin-bottom: 8px;
    }

    #learn-meaning {
      font-size: 18px;
      color: #555;
      margin-bottom: 6px;
    }

    #learn-index {
      font-size: 12px;
      color: #999;
      margin-top: 6px;
    }

    /* Game top bar */
    #game-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 12px;
    }

    #record-label {
      font-weight: 600;
      color: #ff7a7a;
    }

    #stats-label {
      font-size: 12px;
      color: #8a7bb8;
    }

    /* Combo bar */
    #combo-container {
      margin: 6px 0 12px;
      background: #f7e9ff;
      border-radius: 999px;
      height: 12px;
      overflow: hidden;
      position: relative;
      border: 1px solid transparent;
    }

    #combo-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff9fbf, #ffc15e);
      border-radius: 999px;
      transition: width 0.25s ease;
    }

    #combo-container.hollow {
      background: #fff;
      border-color: #f0d7ff;
    }

    #combo-label {
      font-size: 11px;
      color: #8a7bb8;
      text-align: right;
      margin-bottom: 4px;
    }

    /* Avatar */
    #avatar-container {
      display: flex;
      justify-content: center;
      margin: 6px 0 10px;
    }

    #avatar-game {
      width: 96px;
      height: 96px;
      object-fit: contain;
      transition: transform 0.2s ease;
    }

    .avatar-bounce {
      animation: bounce 0.4s ease;
    }

    @keyframes bounce {
      0% { transform: scale(1); }
      30% { transform: scale(1.1); }
      60% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    /* Game word & options */
    #game-word {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin: 8px 0 12px;
      color: #ff7a7a;
    }

    #options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .option {
      width: 100%;
      text-align: center;
      font-size: 13px;
      padding: 10px 6px;
      background: #fdf5ff;
      color: #5b4ea3;
      border-radius: 14px;
      border: 1px solid transparent;
    }

    .option.correct {
      background: #e1ffe8;
      color: #1b7a1b;
      border-color: #9be7b0;
    }

    .option.wrong {
      background: #ffe1e1;
      color: #b00020;
      border-color: #ff9b9b;
    }

    /* Result screen */
    #results-list {
      margin-top: 8px;
      font-size: 13px;
      list-style: none;
    }

    #results-list li {
      margin-bottom: 4px;
    }

    /* Inputs (if needed later) */
    .input {
      width: 100%;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid #ffd6e8;
      background: #fff7fb;
      font-size: 14px;
      margin-bottom: 6px;
    }

    @media (max-width: 480px) {
      #app {
        border-radius: 0;
        max-width: 100%;
        height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- START SCREEN -->
    <div id="screen-start" class="screen active">
      <div class="logo">Anfo</div>
      <div class="subtitle">Cute word game for learning English</div>

      <div class="section center">
        <h3>Choose level</h3>
        <div class="chips" id="level-chips">
          <div class="chip selected" data-level="beginner">Beginner</div>
          <div class="chip" data-level="intermediate">Intermediate</div>
        </div>
      </div>

      <div class="section center">
        <h3>Choose topic</h3>
        <div class="chips" id="topic-chips">
          <div class="chip selected" data-topic="daily">Daily</div>
          <div class="chip" data-topic="food">Food</div>
          <div class="chip" data-topic="travel">Travel</div>
        </div>
      </div>

      <div class="actions-row">
        <button id="btn-start-learn" class="btn-secondary">Learn</button>
        <button id="btn-start-game">Play</button>
      </div>
    </div>

    <!-- LEARN SCREEN -->
    <div id="screen-learn" class="screen">
      <h2>Learn words</h2>
      <div id="learn-card">
        <div id="learn-word"></div>
        <div id="learn-meaning"></div>
        <div id="learn-index"></div>
      </div>
      <div class="actions-row">
        <button id="btn-learn-prev" class="btn-secondary">Previous</button>
        <button id="btn-learn-next">Next</button>
      </div>
      <div class="actions-row">
        <button id="btn-learn-random" class="btn-secondary">Random</button>
        <button id="btn-learn-back" class="btn-secondary">Back</button>
      </div>
    </div>

    <!-- GAME SCREEN -->
    <div id="screen-game" class="screen">
      <div id="game-top">
        <span id="record-label">Best: 0</span>
        <span id="stats-label">Wrong 0 / 0</span>
      </div>

      <div id="combo-label">Combo: 0</div>
      <div id="combo-container">
        <div id="combo-bar"></div>
      </div>

      <div id="avatar-container">
        <img id="avatar-game" src="avatar_neutral.png" alt="avatar" />
      </div>

      <div id="game-word">word</div>

      <div id="options">
        <button class="option"></button>
        <button class="option"></button>
        <button class="option"></button>
        <button class="option"></button>
      </div>

      <div class="actions-row">
        <button id="btn-exit-game" class="btn-secondary">Exit</button>
      </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="screen-result" class="screen">
      <h2>Stage result</h2>
      <div class="center" style="margin-top:8px;">
        <div>Score: <strong id="final-score">0</strong></div>
        <div>Best: <strong id="final-best">0</strong></div>
        <div>Wrong: <strong id="final-wrong">0</strong> / <strong id="final-total">0</strong></div>
      </div>

      <div class="section">
        <h3 style="font-size:14px; margin-bottom:4px;">Wrong words</h3>
        <ul id="results-list"></ul>
      </div>

      <div class="actions-row">
        <button id="btn-repeat-wrong">Repeat wrong ğŸ”</button>
        <button class="btn-secondary" id="btn-play-again">Play again</button>
        <button class="btn-secondary" id="btn-back-home">Home</button>
      </div>
    </div>
  </div>

  <!-- SFX (optional) -->
  <audio id="sfx-correct" src="sfx_correct.mp3"></audio>
  <audio id="sfx-wrong" src="sfx_wrong.mp3"></audio>
  <audio id="sfx-click" src="sfx_click.mp3"></audio>

  <!-- DATA -->
  <script>
    const WORDS_DATA = {
      beginner: {
        daily: [
          { word: "hello", meaning: "Ø³Ù„Ø§Ù…", sentence: "Hello, how are you?" },
          { word: "goodbye", meaning: "Ø®Ø¯Ø§Ø­Ø§ÙØ¸", sentence: "Goodbye, see you later." },
          { word: "please", meaning: "Ù„Ø·ÙØ§Ù‹", sentence: "Please give me the book." },
          { word: "thanks", meaning: "Ù…ØªØ´Ú©Ø±Ù…", sentence: "Thanks for your help." },
          { word: "sorry", meaning: "Ø¨Ø¨Ø®Ø´ÛŒØ¯", sentence: "Sorry for being late." },
          { word: "yes", meaning: "Ø¨Ù„Ù‡", sentence: "Yes, I agree." },
          { word: "no", meaning: "Ù†Ù‡", sentence: "No, I don't want it." },
          { word: "friend", meaning: "Ø¯ÙˆØ³Øª", sentence: "He is my best friend." },
          { word: "family", meaning: "Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡", sentence: "My family is very important to me." },
          { word: "home", meaning: "Ø®Ø§Ù†Ù‡", sentence: "I am going home now." },
          { word: "school", meaning: "Ù…Ø¯Ø±Ø³Ù‡", sentence: "I walk to school every day." },
          { word: "work", meaning: "Ú©Ø§Ø±", sentence: "I work in an office." },
          { word: "happy", meaning: "Ø®ÙˆØ´Ø­Ø§Ù„", sentence: "I feel happy today." },
          { word: "sad", meaning: "ØºÙ…Ú¯ÛŒÙ†", sentence: "She looks sad." },
          { word: "tired", meaning: "Ø®Ø³ØªÙ‡", sentence: "I am tired after work." },
          { word: "morning", meaning: "ØµØ¨Ø­", sentence: "I wake up early in the morning." },
          { word: "night", meaning: "Ø´Ø¨", sentence: "Good night, sleep well." },
          { word: "today", meaning: "Ø§Ù…Ø±ÙˆØ²", sentence: "Today is a good day." },
          { word: "tomorrow", meaning: "ÙØ±Ø¯Ø§", sentence: "I will call you tomorrow." },
          { word: "yesterday", meaning: "Ø¯ÛŒØ±ÙˆØ²", sentence: "Yesterday was fun." },
          { word: "water", meaning: "Ø¢Ø¨", sentence: "I need some water." },
          { word: "phone", meaning: "ØªÙ„ÙÙ†", sentence: "My phone is charging." },
          { word: "time", meaning: "Ø²Ù…Ø§Ù†", sentence: "What time is it?" },
          { word: "money", meaning: "Ù¾ÙˆÙ„", sentence: "I don't have enough money." },
          { word: "love", meaning: "Ø¹Ø´Ù‚", sentence: "I love my family." },
          { word: "name", meaning: "Ù†Ø§Ù…", sentence: "What is your name?" },
          { word: "city", meaning: "Ø´Ù‡Ø±", sentence: "This city is beautiful." },
          { word: "street", meaning: "Ø®ÛŒØ§Ø¨Ø§Ù†", sentence: "I live on this street." },
          { word: "car", meaning: "Ù…Ø§Ø´ÛŒÙ†", sentence: "My car is new." },
          { word: "bus", meaning: "Ø§ØªÙˆØ¨ÙˆØ³", sentence: "The bus is late." },
          { word: "walk", meaning: "Ø±Ø§Ù‡ Ø±ÙØªÙ†", sentence: "I walk every morning." },
          { word: "run", meaning: "Ø¯ÙˆÛŒØ¯Ù†", sentence: "I run to stay healthy." },
          { word: "read", meaning: "Ø®ÙˆØ§Ù†Ø¯Ù†", sentence: "I read books at night." }
        ],
        food: [
          { word: "apple", meaning: "Ø³ÛŒØ¨", sentence: "I eat an apple every day." },
          { word: "banana", meaning: "Ù…ÙˆØ²", sentence: "Bananas are yellow." },
          { word: "orange", meaning: "Ù¾Ø±ØªÙ‚Ø§Ù„", sentence: "I like orange juice." },
          { word: "bread", meaning: "Ù†Ø§Ù†", sentence: "I bought fresh bread." },
          { word: "rice", meaning: "Ø¨Ø±Ù†Ø¬", sentence: "We eat rice for lunch." },
          { word: "egg", meaning: "ØªØ®Ù…â€ŒÙ…Ø±Øº", sentence: "I had eggs for breakfast." },
          { word: "milk", meaning: "Ø´ÛŒØ±", sentence: "Milk is good for health." },
          { word: "tea", meaning: "Ú†Ø§ÛŒ", sentence: "I drink tea every morning." },
          { word: "coffee", meaning: "Ù‚Ù‡ÙˆÙ‡", sentence: "Coffee wakes me up." },
          { word: "chicken", meaning: "Ù…Ø±Øº", sentence: "I like grilled chicken." },
          { word: "meat", meaning: "Ú¯ÙˆØ´Øª", sentence: "Meat is expensive." },
          { word: "fish", meaning: "Ù…Ø§Ù‡ÛŒ", sentence: "Fish is healthy." },
          { word: "soup", meaning: "Ø³ÙˆÙ¾", sentence: "I made vegetable soup." },
          { word: "salad", meaning: "Ø³Ø§Ù„Ø§Ø¯", sentence: "I eat salad every night." },
          { word: "pizza", meaning: "Ù¾ÛŒØªØ²Ø§", sentence: "Pizza is my favorite food." },
          { word: "burger", meaning: "Ø¨Ø±Ú¯Ø±", sentence: "I ordered a burger." },
          { word: "cheese", meaning: "Ù¾Ù†ÛŒØ±", sentence: "Cheese is delicious." },
          { word: "butter", meaning: "Ú©Ø±Ù‡", sentence: "I put butter on bread." },
          { word: "salt", meaning: "Ù†Ù…Ú©", sentence: "Add some salt." },
          { word: "sugar", meaning: "Ø´Ú©Ø±", sentence: "Too much sugar is bad." },
          { word: "juice", meaning: "Ø¢Ø¨Ù…ÛŒÙˆÙ‡", sentence: "I like fresh juice." },
          { word: "watermelon", meaning: "Ù‡Ù†Ø¯ÙˆØ§Ù†Ù‡", sentence: "Watermelon is sweet." },
          { word: "grape", meaning: "Ø§Ù†Ú¯ÙˆØ±", sentence: "Grapes are tasty." },
          { word: "lemon", meaning: "Ù„ÛŒÙ…Ùˆ", sentence: "Lemon is sour." },
          { word: "tomato", meaning: "Ú¯ÙˆØ¬Ù‡", sentence: "Tomatoes are red." },
          { word: "potato", meaning: "Ø³ÛŒØ¨â€ŒØ²Ù…ÛŒÙ†ÛŒ", sentence: "Potatoes are cheap." },
          { word: "onion", meaning: "Ù¾ÛŒØ§Ø²", sentence: "Onions make me cry." },
          { word: "carrot", meaning: "Ù‡ÙˆÛŒØ¬", sentence: "Carrots are orange." },
          { word: "pepper", meaning: "ÙÙ„ÙÙ„", sentence: "Pepper is spicy." },
          { word: "ice cream", meaning: "Ø¨Ø³ØªÙ†ÛŒ", sentence: "I love ice cream." },
          { word: "chocolate", meaning: "Ø´Ú©Ù„Ø§Øª", sentence: "Chocolate is sweet." },
          { word: "cookie", meaning: "Ú©ÙˆÚ©ÛŒ", sentence: "I baked cookies." },
          { word: "honey", meaning: "Ø¹Ø³Ù„", sentence: "Honey is natural sugar." }
        ],
        travel: [
          { word: "ticket", meaning: "Ø¨Ù„ÛŒØª", sentence: "I bought a ticket to Paris." },
          { word: "airport", meaning: "ÙØ±ÙˆØ¯Ú¯Ø§Ù‡", sentence: "The airport is crowded." },
          { word: "flight", meaning: "Ù¾Ø±ÙˆØ§Ø²", sentence: "My flight is delayed." },
          { word: "hotel", meaning: "Ù‡ØªÙ„", sentence: "We booked a hotel room." },
          { word: "room", meaning: "Ø§ØªØ§Ù‚", sentence: "Our room is clean." },
          { word: "passport", meaning: "Ù¾Ø§Ø³Ù¾ÙˆØ±Øª", sentence: "Don't forget your passport." },
          { word: "bag", meaning: "Ú©ÛŒÙ", sentence: "My bag is heavy." },
          { word: "map", meaning: "Ù†Ù‚Ø´Ù‡", sentence: "I need a map." },
          { word: "train", meaning: "Ù‚Ø·Ø§Ø±", sentence: "The train is fast." },
          { word: "station", meaning: "Ø§ÛŒØ³ØªÚ¯Ø§Ù‡", sentence: "Meet me at the station." },
          { word: "bus", meaning: "Ø§ØªÙˆØ¨ÙˆØ³", sentence: "The bus arrives soon." },
          { word: "taxi", meaning: "ØªØ§Ú©Ø³ÛŒ", sentence: "We took a taxi." },
          { word: "city", meaning: "Ø´Ù‡Ø±", sentence: "This city is beautiful." },
          { word: "country", meaning: "Ú©Ø´ÙˆØ±", sentence: "I love this country." },
          { word: "beach", meaning: "Ø³Ø§Ø­Ù„", sentence: "The beach is relaxing." },
          { word: "sea", meaning: "Ø¯Ø±ÛŒØ§", sentence: "The sea is blue." },
          { word: "mountain", meaning: "Ú©ÙˆÙ‡", sentence: "The mountain is high." },
          { word: "island", meaning: "Ø¬Ø²ÛŒØ±Ù‡", sentence: "We visited an island." },
          { word: "tour", meaning: "ØªÙˆØ±", sentence: "We joined a city tour." },
          { word: "guide", meaning: "Ø±Ø§Ù‡Ù†Ù…Ø§", sentence: "The guide was helpful." },
          { word: "camera", meaning: "Ø¯ÙˆØ±Ø¨ÛŒÙ†", sentence: "I forgot my camera." },
          { word: "photo", meaning: "Ø¹Ú©Ø³", sentence: "I took many photos." },
          { word: "travel", meaning: "Ø³ÙØ±", sentence: "I love to travel." },
          { word: "visit", meaning: "Ø¨Ø§Ø²Ø¯ÛŒØ¯", sentence: "We visited a museum." },
          { word: "museum", meaning: "Ù…ÙˆØ²Ù‡", sentence: "The museum was amazing." },
          { word: "park", meaning: "Ù¾Ø§Ø±Ú©", sentence: "We walked in the park." },
          { word: "bridge", meaning: "Ù¾Ù„", sentence: "The bridge is long." },
          { word: "road", meaning: "Ø¬Ø§Ø¯Ù‡", sentence: "The road is empty." },
          { word: "car", meaning: "Ù…Ø§Ø´ÛŒÙ†", sentence: "We rented a car." },
          { word: "driver", meaning: "Ø±Ø§Ù†Ù†Ø¯Ù‡", sentence: "The driver was friendly." },
          { word: "bag", meaning: "Ú†Ù…Ø¯Ø§Ù†", sentence: "My bag is full." },
          { word: "airport bus", meaning: "Ø§ØªÙˆØ¨ÙˆØ³ ÙØ±ÙˆØ¯Ú¯Ø§Ù‡", sentence: "We took the airport bus." },
          { word: "check-in", meaning: "Ú†Ú©â€ŒØ§ÛŒÙ†", sentence: "We checked in early." }
        ]
      },
      intermediate: {
        daily: [],
        food: [],
        travel: []
      }
    };
  </script>

  <script>
    // STATE
    let currentLevel = "beginner";
    let currentTopic = "daily";

    let learnList = [];
    let learnIndex = 0;

    let gameQuestions = [];
    let gameIndex = 0;
    let wrongWords = [];
    let score = 0;
    let bestScore = 0;
    let wrongCount = 0;
    let totalCount = 0;
    let combo = 0;
    const maxComboForFullBar = 5;

    // ELEMENTS
    const screenStart = document.getElementById("screen-start");
    const screenLearn = document.getElementById("screen-learn");
    const screenGame = document.getElementById("screen-game");
    const screenResult = document.getElementById("screen-result");

    const levelChips = document.getElementById("level-chips");
    const topicChips = document.getElementById("topic-chips");

    const btnStartLearn = document.getElementById("btn-start-learn");
    const btnStartGame = document.getElementById("btn-start-game");

    const learnWordEl = document.getElementById("learn-word");
    const learnMeaningEl = document.getElementById("learn-meaning");
    const learnIndexEl = document.getElementById("learn-index");
    const btnLearnPrev = document.getElementById("btn-learn-prev");
    const btnLearnNext = document.getElementById("btn-learn-next");
    const btnLearnRandom = document.getElementById("btn-learn-random");
    const btnLearnBack = document.getElementById("btn-learn-back");

    const recordLabel = document.getElementById("record-label");
    const statsLabel = document.getElementById("stats-label");
    const comboLabel = document.getElementById("combo-label");
    const comboContainer = document.getElementById("combo-container");
    const comboBar = document.getElementById("combo-bar");
    const avatarGame = document.getElementById("avatar-game");
    const gameWordEl = document.getElementById("game-word");
    const optionButtons = document.querySelectorAll(".option");
    const btnExitGame = document.getElementById("btn-exit-game");

    const finalScoreLabel = document.getElementById("final-score");
    const finalBestLabel = document.getElementById("final-best");
    const finalWrongLabel = document.getElementById("final-wrong");
    const finalTotalLabel = document.getElementById("final-total");
    const resultsList = document.getElementById("results-list");
    const btnRepeatWrong = document.getElementById("btn-repeat-wrong");
    const btnPlayAgain = document.getElementById("btn-play-again");
    const btnBackHome = document.getElementById("btn-back-home");

    const sfxCorrect = document.getElementById("sfx-correct");
    const sfxWrong = document.getElementById("sfx-wrong");
    const sfxClick = document.getElementById("sfx-click");

    // HELPERS
    function showScreen(screen) {
      [screenStart, screenLearn, screenGame, screenResult].forEach(s => s.classList.remove("active"));
      screen.classList.add("active");
    }

    function playSfx(audioEl) {
      if (!audioEl) return;
      audioEl.currentTime = 0;
      audioEl.play().catch(() => {});
    }

    function shuffleArray(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function setAvatarMood(mood) {
      let src = "avatar_neutral.png";
      if (mood === "sad") src = "avatar_sad.png";
      else if (mood === "happy") src = "avatar_happy.png";
      else if (mood === "super-happy") src = "avatar_super_happy.png";

      avatarGame.src = src;
      avatarGame.classList.remove("avatar-bounce");
      void avatarGame.offsetWidth;
      avatarGame.classList.add("avatar-bounce");
    }

    function updateComboBar() {
      const ratio = Math.min(combo / maxComboForFullBar, 1);
      comboBar.style.width = (ratio * 100) + "%";
      comboLabel.textContent = "Combo: " + combo;
      if (combo === 0) {
        comboContainer.classList.add("hollow");
      } else {
        comboContainer.classList.remove("hollow");
      }
    }

    function loadBestScore() {
      const saved = localStorage.getItem("anfo_best_score");
      bestScore = saved ? parseInt(saved, 10) : 0;
      recordLabel.textContent = "Best: " + bestScore;
    }

    function saveBestScore() {
      localStorage.setItem("anfo_best_score", bestScore.toString());
    }

    // LEVEL & TOPIC
    levelChips.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      levelChips.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
      chip.classList.add("selected");
      currentLevel = chip.dataset.level;
      playSfx(sfxClick);
    });

    topicChips.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      topicChips.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
      chip.classList.add("selected");
      currentTopic = chip.dataset.topic;
      playSfx(sfxClick);
    });

    // LEARN MODE
    btnStartLearn.addEventListener("click", () => {
      playSfx(sfxClick);
      const levelData = WORDS_DATA[currentLevel] || {};
      const list = levelData[currentTopic] || [];
      if (!list.length) {
        alert("No words for this level/topic yet.");
        return;
      }
      learnList = shuffleArray(list); // Ø±Ù†Ø¯ÙˆÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯Ø§Ù†Ù‡
      learnIndex = 0;
      showScreen(screenLearn);
      showLearnItem();
    });

    function showLearnItem() {
      const item = learnList[learnIndex];
      learnWordEl.textContent = item.word;
      learnMeaningEl.textContent = item.meaning;
      learnIndexEl.textContent = (learnIndex + 1) + " / " + learnList.length;
    }

    btnLearnPrev.addEventListener("click", () => {
      playSfx(sfxClick);
      if (learnIndex > 0) {
        learnIndex--;
      } else {
        learnIndex = learnList.length - 1;
      }
      showLearnItem();
    });

    btnLearnNext.addEventListener("click", () => {
      playSfx(sfxClick);
      if (learnIndex < learnList.length - 1) {
        learnIndex++;
      } else {
        learnIndex = 0;
      }
      showLearnItem();
    });

    btnLearnRandom.addEventListener("click", () => {
      playSfx(sfxClick);
      learnIndex = Math.floor(Math.random() * learnList.length);
      showLearnItem();
    });

    btnLearnBack.addEventListener("click", () => {
      playSfx(sfxClick);
      showScreen(screenStart);
    });

    // GAME MODE
    btnStartGame.addEventListener("click", () => {
      playSfx(sfxClick);
      const levelData = WORDS_DATA[currentLevel] || {};
      const list = levelData[currentTopic] || [];
      if (!list.length) {
        alert("No words for this level/topic yet.");
        return;
      }
      gameQuestions = shuffleArray(list);
      gameIndex = 0;
      wrongWords = [];
      score = 0;
      wrongCount = 0;
      totalCount = gameQuestions.length;
      combo = 0;
      loadBestScore();
      updateComboBar();
      statsLabel.textContent = "Wrong 0 / " + totalCount;
      setAvatarMood("neutral");
      showScreen(screenGame);
      loadGameQuestion();
    });

    function loadGameQuestion() {
      if (gameIndex >= gameQuestions.length) {
        endGame();
        return;
      }

      const q = gameQuestions[gameIndex];
      gameWordEl.textContent = q.word;

      let options = [q.meaning];
      while (options.length < 4 && gameQuestions.length > 1) {
        const random = gameQuestions[Math.floor(Math.random() * gameQuestions.length)].meaning;
        if (!options.includes(random)) options.push(random);
      }
      while (options.length < 4) {
        options.push("â€”");
      }
      options = shuffleArray(options);

      optionButtons.forEach((btn, i) => {
        btn.disabled = false;
        btn.classList.remove("correct", "wrong");
        btn.textContent = options[i];
        btn.onclick = () => checkAnswer(options[i] === q.meaning, q, btn);
      });
    }

    function checkAnswer(isCorrect, wordObj, btn) {
      optionButtons.forEach(b => b.disabled = true);

      if (isCorrect) {
        score += 10;
        combo++;
        btn.classList.add("correct");
        setAvatarMood(combo >= maxComboForFullBar ? "super-happy" : "happy");
        playSfx(sfxCorrect);
      } else {
        score -= 5;
        combo = 0;
        wrongCount++;
        wrongWords.push(wordObj);
        btn.classList.add("wrong");
        setAvatarMood("sad");
        playSfx(sfxWrong);
      }

      updateComboBar();
      statsLabel.textContent = "Wrong " + wrongCount + " / " + totalCount;

      setTimeout(() => {
        gameIndex++;
        loadGameQuestion();
      }, 700);
    }

    function endGame() {
      showScreen(screenResult);
      finalScoreLabel.textContent = score;
      if (score > bestScore) {
        bestScore = score;
        saveBestScore();
      }
      finalBestLabel.textContent = bestScore;
      finalWrongLabel.textContent = wrongCount;
      finalTotalLabel.textContent = totalCount;

      resultsList.innerHTML = "";
      if (!wrongWords.length) {
        const li = document.createElement("li");
        li.textContent = "No wrong words. Great job! ğŸ‰";
        resultsList.appendChild(li);
      } else {
        wrongWords.forEach(w => {
          const li = document.createElement("li");
          li.textContent = w.word + " = " + w.meaning;
          resultsList.appendChild(li);
        });
      }
    }

    btnExitGame.addEventListener("click", () => {
      playSfx(sfxClick);
      showScreen(screenStart);
    });

    btnRepeatWrong.addEventListener("click", () => {
      playSfx(sfxClick);
      if (!wrongWords.length) {
        alert("No wrong words to repeat.");
        return;
      }
      gameQuestions = shuffleArray(wrongWords);
      wrongWords = [];
      gameIndex = 0;
      score = 0;
      wrongCount = 0;
      totalCount = gameQuestions.length;
      combo = 0;
      updateComboBar();
      statsLabel.textContent = "Wrong 0 / " + totalCount;
      setAvatarMood("neutral");
      showScreen(screenGame);
      loadGameQuestion();
    });

    btnPlayAgain.addEventListener("click", () => {
      playSfx(sfxClick);
      const levelData = WORDS_DATA[currentLevel] || {};
      const list = levelData[currentTopic] || [];
      if (!list.length) {
        alert("No words for this level/topic yet.");
        return;
      }
      gameQuestions = shuffleArray(list);
      wrongWords = [];
      gameIndex = 0;
      score = 0;
      wrongCount = 0;
      totalCount = gameQuestions.length;
      combo = 0;
      updateComboBar();
      statsLabel.textContent = "Wrong 0 / " + totalCount;
      setAvatarMood("neutral");
      showScreen(screenGame);
      loadGameQuestion();
    });

    btnBackHome.addEventListener("click", () => {
      playSfx(sfxClick);
      showScreen(screenStart);
    });

    // INIT
    loadBestScore();
  </script>
</body>
</html>
